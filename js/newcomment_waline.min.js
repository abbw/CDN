/**
 * Minified by jsDelivr using Terser v5.17.1.
 * Original file: /gh/abbw/CDN@master/newcomment_waline.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const saveToLocal={set:function(e,t,n){const a=864e5*n,r={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(r))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const n=JSON.parse(t);if(!((new Date).getTime()>n.expiry))return n.value;localStorage.removeItem(e)}},diffDate=(e,t=!1)=>{const n=new Date,a=new Date(e),r=n.getTime()-a.getTime(),c=36e5,o=24*c;let i;if(t){const e=r/2592e6,t=r/o,n=r/c,l=r/6e4;i=e>12?a.toLocaleDateString().replace(/\//g,"-"):e>=1?parseInt(e)+" 个月前":t>=1?parseInt(t)+" 天前":n>=1?parseInt(n)+" 小时前":l>=1?parseInt(l)+" 分钟前":"刚刚"}else i=parseInt(r/o);return i},changeContent=e=>(""===e||(e=(e=(e=(e=e.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(e=e.substring(0,150)+"..."),e),getIcon=(e,t)=>{if(e)return e;return"https://sdn.geekzu.org/avatar/"+(t+"?d=mp")},generateHtml=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++)t+="<div class='newcomment-list-item'>",t+=`<a href='${e[n].url}' class="thumbnail"><img src='${e[n].avatar}' alt='${e[n].nick}'></a>`,t+=`<div class='content'>\n      <a class='comment' href='${e[n].url}'>${e[n].content}</a>\n      <div class='name'><span>${e[n].nick} / </span><time datetime="${e[n].date}">${diffDate(e[n].date,!0)}</time></div>\n      </div></div>`;else t+="没有评论";document.querySelector(".newcomment-list").innerHTML=t},getComment=()=>{let e=document.querySelector(".newcomment-list").getAttribute("data-api"),t=document.querySelector(".newcomment-list").getAttribute("data-num");fetch(`${e}/comment?type=recent&count=${t}`).then((e=>e.json())).then((e=>{const t=e.map((e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:getIcon(e.avatar,e.mail),nick:e.nick,url:e.url+"#"+e.objectId,date:e.updatedAt};var t}));saveToLocal.set("waline-newest-comments",JSON.stringify(t),10/1440),generateHtml(t)})).catch((e=>{document.querySelector(".newcomment-list").innerHTML="无法获取 Waline 评论，请确认相关配置是否正确"}))},newestCommentInit=()=>{if(document.querySelector(".newcomment-list")){const e=saveToLocal.get("waline-newest-comments");e?generateHtml(JSON.parse(e)):getComment()}};(function(e,t){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1})(["qzkyl.ml","localhost","abbw.gitee.io"],window.location.host)?newestCommentInit():(alert("请勿盗取窃用脚本。\n作者：笨蛋海绵\nQQ：1037887804"),window.top.location.href="https://qzkyl.ml/");
//# sourceMappingURL=/sm/fd75fed5af65fb3dfbbf4a4a63350d6a16dbd6293f537b471509167ba464c924.map